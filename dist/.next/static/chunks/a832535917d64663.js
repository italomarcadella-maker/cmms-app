(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,s,a)=>{s.exports=e.r(76562)},31278,e=>{"use strict";let s=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>s],31278)},43531,e=>{"use strict";let s=(0,e.i(75254).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>s],43531)},83007,e=>{"use strict";var s=e.i(43476),a=e.i(71645),t=e.i(18566),i=e.i(31278),r=e.i(22016),n=e.i(8493),l=e.i(81233),d=e.i(63771),o=e.i(37727),c=e.i(43531),m=e.i(47163);function u({label:e,options:t,value:i,onChange:r,placeholder:n,onCreate:l}){let[d,u]=(0,a.useState)(!1),[p,x]=(0,a.useState)(""),h=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=e=>{h.current&&!h.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let g=()=>{p.trim()&&l&&(l(p.trim()),x(""))},f=i.map(e=>t.find(s=>s.id===e)?.label).filter(Boolean);return(0,s.jsxs)("div",{className:"space-y-2",ref:h,children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:e}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("div",{className:"min-h-10 w-full rounded-md border bg-background px-3 py-2 text-sm focus-within:ring-2 focus-within:ring-primary cursor-pointer flex flex-wrap gap-2",onClick:()=>u(!d),children:[0===f.length&&(0,s.jsx)("span",{className:"text-muted-foreground",children:n||"Select..."}),f.map((e,a)=>(0,s.jsxs)("span",{className:"bg-primary/10 text-primary text-xs px-2 py-1 rounded-full flex items-center gap-1",children:[e,(0,s.jsx)("span",{role:"button",onClick:s=>{s.stopPropagation(),r(i.filter(s=>t.find(e=>e.id===s)?.label!==e))},className:"hover:text-primary/70",children:(0,s.jsx)(o.X,{className:"h-3 w-3"})})]},a))]}),d&&(0,s.jsxs)("div",{className:"absolute z-50 w-full mt-1 rounded-md border bg-background text-foreground shadow-lg max-h-60 overflow-y-auto p-1 ring-1 ring-black/5",children:[l&&(0,s.jsxs)("div",{className:"flex gap-2 p-2 border-b mb-1",children:[(0,s.jsx)("input",{className:"flex-1 bg-transparent text-sm outline-none",placeholder:"Create new...",value:p,onChange:e=>x(e.target.value),onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),g())}}),(0,s.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),g()},className:"text-xs font-medium text-primary",children:"Add"})]}),t.map(e=>(0,s.jsxs)("div",{className:(0,m.cn)("flex items-center justify-between px-2 py-1.5 text-sm rounded-sm cursor-pointer hover:bg-accent hover:text-accent-foreground",i.includes(e.id)&&"bg-accent/50"),onClick:()=>{var s;return s=e.id,void(i.includes(s)?r(i.filter(e=>e!==s)):r([...i,s]))},children:[e.label,i.includes(e.id)&&(0,s.jsx)(c.Check,{className:"h-4 w-4 text-primary"})]},e.id))]})]})]})}function p(){let e=(0,t.useRouter)(),o=(0,t.useSearchParams)(),{addWorkOrder:c}=(0,n.useWorkOrders)(),{assets:m}=(0,l.useAssets)(),{activities:p,technicians:x,addActivity:h,addTechnician:g}=(0,d.useReference)(),[f,b]=(0,a.useState)(!1),[y,j]=(0,a.useState)([]),v=o.get("assetId")||"",N=o.get("title")||"",k=o.get("priority")||"LOW";async function w(s){s.preventDefault(),b(!0);let a=new FormData(s.currentTarget);await new Promise(e=>setTimeout(e,800));let t=a.get("assetId"),i=m.find(e=>e.id===t),r=y.map((e,s)=>{let a=p.find(s=>s.id===e);return{id:`CHK-${Math.floor(1e4*Math.random())}`,label:a?a.label:"Unknown Task",completed:!1}}),n=r.map(e=>e.label).join(", ")||a.get("description"),l=a.get("assignedTechnicianId"),d=x.find(e=>e.id===l);c({id:`WO-${Math.floor(1e4*Math.random())}`,title:a.get("title"),description:n||"Maintenance Task",assetId:t,assetName:i?i.name:"Unknown Asset",priority:a.get("priority"),status:"OPEN",assignedTo:d?d.name:"Unassigned",assignedTechnicianId:l,dueDate:a.get("dueDate"),createdAt:new Date().toISOString().split("T")[0],checklist:r,category:a.get("category")||"OTHER",partsUsed:[],laborLogs:[]}),b(!1),e.push("/work-orders")}return(0,s.jsxs)("form",{onSubmit:w,className:"space-y-8 max-w-2xl",children:[(0,s.jsxs)("div",{className:"space-y-4 rounded-lg border bg-card p-6 shadow-sm",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"Dettagli Task"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"title",className:"text-sm font-medium",children:"Titolo"}),(0,s.jsx)("input",{required:!0,id:"title",name:"title",defaultValue:N,className:"flex h-10 w-full rounded-md border bg-background px-3 py-2 text-sm focus:ring-2 focus:ring-primary outline-none",placeholder:"es. Guarnizione rotta"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"category",className:"text-sm font-medium",children:"Categoria"}),(0,s.jsxs)("select",{required:!0,id:"category",name:"category",className:"flex h-10 w-full rounded-md border bg-background px-3 py-2 text-sm focus:ring-2 focus:ring-primary outline-none",children:[(0,s.jsx)("option",{value:"MECHANICAL",children:"Meccanica"}),(0,s.jsx)("option",{value:"ELECTRICAL",children:"Elettrica"}),(0,s.jsx)("option",{value:"HYDRAULIC",children:"Idraulica"}),(0,s.jsx)("option",{value:"PNEUMATIC",children:"Pneuamtica"}),(0,s.jsx)("option",{value:"OTHER",children:"Altro"})]})]}),(0,s.jsx)(u,{label:"Attività di Manutenzione (Checklist)",options:p.map(e=>({id:e.id,label:e.label})),value:y,onChange:j,onCreate:h,placeholder:"Seleziona task..."}),(0,s.jsx)("input",{type:"hidden",name:"description",value:y.map(e=>p.find(s=>s.id===e)?.label).join(", ")})]})]}),(0,s.jsxs)("div",{className:"space-y-4 rounded-lg border bg-card p-6 shadow-sm",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"Pianificazione"}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"assetId",className:"text-sm font-medium",children:"Asset"}),(0,s.jsxs)("select",{required:!0,id:"assetId",name:"assetId",defaultValue:v,className:"flex h-10 w-full rounded-md border bg-background px-3 py-2 text-sm focus:ring-2 focus:ring-primary outline-none",children:[(0,s.jsx)("option",{value:"",children:"Seleziona un asset..."}),m.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," (",e.serialNumber,")"]},e.id))]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"priority",className:"text-sm font-medium",children:"Priorità"}),(0,s.jsxs)("select",{required:!0,id:"priority",name:"priority",defaultValue:k,className:"flex h-10 w-full rounded-md border bg-background px-3 py-2 text-sm focus:ring-2 focus:ring-primary outline-none",children:[(0,s.jsx)("option",{value:"LOW",children:"Bassa"}),(0,s.jsx)("option",{value:"MEDIUM",children:"Media"}),(0,s.jsx)("option",{value:"HIGH",children:"Alta"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"assignedTechnicianId",className:"text-sm font-medium",children:"Tecnico Assegnato"}),(0,s.jsxs)("select",{id:"assignedTechnicianId",name:"assignedTechnicianId",required:!0,className:"flex h-10 w-full rounded-md border bg-background px-3 py-2 text-sm focus:ring-2 focus:ring-primary outline-none",children:[(0,s.jsx)("option",{value:"",children:"Seleziona tecnico..."}),x.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," (",e.specialty,")"]},e.id))]}),(0,s.jsx)("input",{type:"hidden",name:"assignedTo"})," "]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"dueDate",className:"text-sm font-medium",children:"Scadenza"}),(0,s.jsx)("input",{required:!0,type:"date",id:"dueDate",name:"dueDate",className:"flex h-10 w-full rounded-md border bg-background px-3 py-2 text-sm focus:ring-2 focus:ring-primary outline-none"})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(r.default,{href:"/work-orders",className:"inline-flex items-center justify-center rounded-md border bg-background px-4 py-2 text-sm font-medium hover:bg-muted",children:"Annulla"}),(0,s.jsxs)("button",{disabled:f,type:"submit",className:"inline-flex items-center gap-2 rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 disabled:opacity-50",children:[f&&(0,s.jsx)(i.Loader2,{className:"h-4 w-4 animate-spin"}),"Crea Ordine"]})]})]})}e.s(["WorkOrderForm",()=>p],83007)}]);